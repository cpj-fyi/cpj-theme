{{!< default}}

{{!--
    Default page template
    Detects if page is a book chapter (has section tag) and shows chapter layout with sidebar
    Otherwise shows standard page layout
--}}

{{#post}}
    {{!-- Check if this is a book chapter by looking for section tags --}}
    {{#has tag="start-end, foundations, structuring, direction, learning, practice, space"}}
        {{!-- Mobile chapter nav - horizontal scrollable buttons --}}
        {{> "mobile-chapter-nav"}}

        {{!-- Book chapter layout with sidebar --}}
        <article class="page chapter-page {{post_class}}">
            <div class="container">
                <div class="chapter-layout">
                    {{!-- Chapter sidebar - desktop only --}}
                    <aside class="chapter-sidebar" id="chapter-sidebar">
                        {{!-- List chapters in this section --}}
                        <nav class="chapter-list-nav" id="chapter-list-nav">
                            {{#foreach tags}}
                                {{#match slug "start-end"}}
                                    {{#get "pages" filter="tag:start-end" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                                {{#match slug "foundations"}}
                                    {{#get "pages" filter="tag:foundations" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                                {{#match slug "structuring"}}
                                    {{#get "pages" filter="tag:structuring" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                                {{#match slug "direction"}}
                                    {{#get "pages" filter="tag:direction" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                                {{#match slug "learning"}}
                                    {{#get "pages" filter="tag:learning" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                                {{#match slug "practice"}}
                                    {{#get "pages" filter="tag:practice" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                                {{#match slug "space"}}
                                    {{#get "pages" filter="tag:space" limit="50" order="published_at asc" as |chapters|}}
                                        <ul class="chapter-list">
                                            {{#foreach chapters}}
                                                <li class="chapter-list-item">
                                                    <a href="{{url}}" class="chapter-list-link">{{title}}</a>
                                                </li>
                                            {{/foreach}}
                                        </ul>
                                    {{/get}}
                                {{/match}}
                            {{/foreach}}
                        </nav>
                    </aside>

                    {{!-- Chapter content --}}
                    <div class="chapter-content">
                        <header class="post-header">
                            <h1 class="post-title">{{title}}</h1>
                            {{#if custom_excerpt}}
                                <p class="post-excerpt">{{custom_excerpt}}</p>
                            {{/if}}
                        </header>

                        {{#if feature_image}}
                            <figure class="post-feature-image">
                                <img src="{{feature_image}}" alt="{{title}}">
                                {{#if feature_image_caption}}
                                    <figcaption>{{feature_image_caption}}</figcaption>
                                {{/if}}
                            </figure>
                        {{/if}}

                        <div class="post-body">
                            <div class="content-wrapper">
                                <div class="content">
                                    {{content}}
                                </div>

                                {{#unless @member}}
                                    <div class="membership-cta">
                                        <p>Send me a receipt showing that you pre-ordered the book, and then sign in. You'll get a magic link and then all these chapters are yours to read.</p>
                                        <div class="membership-cta-buttons">
                                            <a href="#/portal/signin" class="btn btn-secondary">Sign in</a>
                                        </div>
                                    </div>
                                {{/unless}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
    {{else}}
        {{!-- Standard page layout --}}
        <article class="page {{post_class}}">
            <header class="post-header">
                <h1 class="post-title">{{title}}</h1>
                {{#if custom_excerpt}}
                    <p class="post-excerpt">{{custom_excerpt}}</p>
                {{/if}}
            </header>

            {{#if feature_image}}
                <figure class="post-feature-image">
                    <img src="{{feature_image}}" alt="{{title}}">
                    {{#if feature_image_caption}}
                        <figcaption>{{feature_image_caption}}</figcaption>
                    {{/if}}
                </figure>
            {{/if}}

            <div class="post-body">
                <div class="content">
                    {{content}}
                </div>
            </div>
        </article>
    {{/has}}
{{/post}}
